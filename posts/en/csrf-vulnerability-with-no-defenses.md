---
id: "csrf-vulnerability-with-no-defenses"
title: "CSRF vulnerability with no defenses â€“ PortSwigger Write Up"
author: "juan-antonio-gonzalez-mena"
publishedDate: 2022-06-14
updatedDate: 2022-06-14
image: "https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-0.webp"
description: "Learn how to exploit a CSRF vulnerability without defenses in PortSwigger Lab. Step-by-step guide to create a malicious HTML page that changes the victim's email through Cross-Site Request Forgery."
categories:
  - "portswigger-labs"
draft: false
featured: false
lang: "en"
---

In this post, we're going to be solving the lab: "CSRF vulnerability with no defenses".

![CSRF vulnerability with no defenses lab start screen](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-1.avif)

In this case, the lab indicates that there's a CSRF vulnerability in the email change functionality. To solve the lab, we must create an HTML page that exploits the CSRF to change the email of whoever visits our website. Finally, we're provided with credentials to access an account.

Knowing all this, we start the lab and navigate to "My account" to log in:

![My account button to access user panel](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-2.avif)

![Login form with credentials](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-3.avif)

Once we've logged in, we're redirected to our profile:

![User profile panel with email update field](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-4.avif)

Here, as the statement mentioned, we find a functionality to change our account's email, so we prepare Burp Suite to intercept the change request:

![Proxy configuration in the browser](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-5.avif)

![Burp Suite interceptor activated and waiting](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-6.avif)

With Burp Suite ready, we enter a random email and click on `Update email`:

![Email change form with new value](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-7.avif)

As soon as we click, Burp Suite receives the request:

![POST request intercepted in Burp Suite showing email parameter](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-8.avif)

And as we can observe, the only parameter sent in the request body is `email`. There's no other parameter whose value is random and impossible to predict, making it possible to create a malicious template that generates a request like the one shown above, keeping in mind that a site's cookies are included in any request the browser makes to that site.

If we let this request be sent, the email will change without issues:

![Successful email update confirmation](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-9.avif)

We now know all the necessary information and everything works as expected, so we disable the proxy and navigate to the exploit server:

![Button to access the exploit server](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-10.avif)

![Exploit server interface in PortSwigger](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-11.avif)

Once inside, we have the following fields:

![Exploit server fields to configure the attack](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-12.avif)

This is where we create the malicious HTML template that will generate the request we saw above when the victim visits the page:

![CSRF exploit HTML code in the server](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-13.avif)

The HTML code is as follows:

```html
<html>
    <body>
        <form action='<URL where the email change is made>' method='<HTTP METHOD>'>
            <input name="email" value="<new value, in this case the email>" type="hidden"/>  
        </form>
        <script>
            document.forms[0].submit();
        </script>
    </body>
</html>
```

If we click to view the exploit, we ourselves will visit the malicious page:

![Exploit preview before sending it](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-14.avif)

Since we have the session saved in the browser with the cookies, when visiting it, the request is generated correctly and the email is changed, all from just visiting the malicious website:

![Email automatically updated after visiting the exploit](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-15.avif)

So, what happened is:
- The malicious website generates a specially crafted request when visited.
- If the user is logged in to the vulnerable website (in this case), the browser will automatically include the session cookie in the request (assuming the `SameSite` attribute of the cookie is not enabled, which is not the case here)
- The malicious website will process the request, since it's impossible to differentiate whether it was made by the victim themselves or not, so it will process it without issues and the email address will be changed.

Since we've observed that the exploit works perfectly, we can simply send it to the victim:

![Button to deliver the exploit to the victim](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-16.avif)

And this way, we solve the lab:

![Lab solved successfully message](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-17.avif)

![Final confirmation of lab success](https://cdn.deephacking.tech/i/posts/portswigger-labs/csrf-vulnerability-with-no-defenses/csrf-vulnerability-with-no-defenses-18.avif)
