---
id: "configuracion-dispositivo-fisico-android"
title: "Configuraci√≥n de Dispositivo F√≠sico para Pentesting Android"
author: "pablo-castillo"
publishedDate: 2024-11-05
updatedDate: 2024-11-05
image: "https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-0.webp"
description: "Aprende a configurar un dispositivo f√≠sico Android para pentesting mediante rooteo con Magisk, incluyendo desbloqueo de bootloader, instalaci√≥n de custom recovery y configuraci√≥n de certificados de Burp Suite."
categories:
  - "mobile-pentesting"
draft: false
featured: false
lang: "es"
---

El objetivo de este post es aprender a configurar un dispositivo m√≥vil f√≠sico para poder realizar pruebas de pentesting de aplicaciones Android. Este m√©todo es una alternativa de trabajo al post sobre la [creaci√≥n de un entorno virtualizado en Android Studio](https://blog.deephacking.tech/es/posts/creacion-entorno-trabajo-android/) que vimos anteriormente. La principal ventaja de trabajar con un dispositivo f√≠sico es que nos ahorraremos mucho espacio y recursos de nuestro ordenador al no tener que descargar y trabajar con dispositivos emulados, adem√°s de la comodidad de manejarlo con nuestras propias manos.

- [Antes de comenzar](#antes-de-comenzar)
- [¬øQu√© significa rootear un dispositivo?](#qu√©-significa-rootear-un-dispositivo)
- [¬øQu√© es Magisk?](#qu√©-es-magisk)
- [C√≥mo instalar Magisk en nuestro dispositivo Android](#c√≥mo-instalar-magisk-en-nuestro-dispositivo-android)
- [Habilitar las Opciones de Desarrollador en nuestro dispositivo](#habilitar-las-opciones-de-desarrollador-en-nuestro-dispositivo)
- [Depuraci√≥n por USB](#depuraci√≥n-por-usb)
- [Desbloqueo de OEM](#desbloqueo-de-oem)
- [Desbloqueo de Bootloader e instalaci√≥n del Custom Recovery](#desbloqueo-de-bootloader-e-instalaci√≥n-del-custom-recovery)
    - [Problema 1: El OEM no se ha desbloqueado correcta o completamente](#problema-1-el-oem-no-se-ha-desbloqueado-correcta-o-completamente)
        - [Bonus: Desbloquear el OEM en un dispositivo Xiaomi](#bonus-desbloquear-el-oem-en-un-dispositivo-xiaomi)
    - [Problema 2: El comando fastboot devices no muestra vuestro dispositivo](#problema-2-el-comando-fastboot-devices-no-muestra-vuestro-dispositivo)
- [Uso del Custom Recovery e instalaci√≥n de Magisk en el sistema ra√≠z](#uso-del-custom-recovery-e-instalaci√≥n-de-magisk-en-el-sistema-ra√≠z)
- [Bonus: Instalaci√≥n del certificado de Burp Suite a trav√©s de Magisk](#bonus-instalaci√≥n-del-certificado-de-burp-suite-a-trav√©s-de-magisk)
- [Conclusi√≥n](#conclusi√≥n)
- [Referencias](#referencias)

## Antes de comenzar

Seguramente lo sepas o te lo puedas imaginar, pero nunca est√° de m√°s hacer este tipo de recordatorios. Si solo dispones de un dispositivo m√≥vil Android y es el de tu uso personal, NUNCA lo manipules ni modifiques sus configuraciones para acciones como rootearlo u otras opciones. Algunas desventajas de estas alteraciones son las siguientes:

- Da√±o del dispositivo
- P√©rdida de garant√≠a
- Aumento de vulnerabilidades
- P√©rdida de actualizaciones autom√°ticas
- Imposibilidad de uso de m√∫ltiples aplicaciones

Emplea siempre un dispositivo que ya no utilices y sobre el que no te importe correr riesgos para hacer este tipo de pruebas. Adem√°s, inf√≥rmate siempre antes de instalar aplicaciones o realizar cualquier tipo de cambios.

## ¬øQu√© significa rootear un dispositivo?

Cuando utilizamos un dispositivo Android, siempre lo hacemos con los privilegios de un usuario normal sin ning√∫n tipo de privilegio, por lo que nuestras acciones sobre el dispositivo est√°n siempre limitadas. Al rootearlo, se obtienen permisos de superusuario por lo que se puede realizar cualquier tipo de acci√≥n sobre el sistema operativo. En pocas palabras, puedes hacer lo que te de la gana con √©l. El principal problema es que dicho superusuario se encuentra bloqueado por defecto, por lo que es el fabricante del dispositivo el que controla qu√© cambios se pueden hacer en sus dispositivos, as√≠ pues dependiendo de la marca que tengamos puede haber algunas variaciones en estas limitaciones.

¬øY para qu√© se suelen rootear los dispositivos m√≥viles? Pues bien, la principal acci√≥n que se suele hacer en los dispositivos rooteados es la instalaci√≥n de ROMs (Read Only Memory o memoria solo de lectura, la memoria interna que almacena el sistema operativo) personalizadas o m√°s actualizadas a las que tu dispositivo puede acceder de manera est√°ndar. Adem√°s tambi√©n se emplea para eliminar aplicaciones o funcionalidades que vienen instaladas en el dispositivo por defecto y que como usuario normal no se pueden eliminar, as√≠ como instalar otras aplicaciones o funcionalidades prohibidas por defecto.

**En nuestro caso, necesitaremos tener privilegios de superusuario del dispositivo para poder realizar de manera adecuada todas las pruebas de pentesting necesarias sobre las aplicaciones que queramos auditar.**

Sin embargo, existe una manera de conseguir m√°ximos privilegios sobre el disposivito Android sin la necesidad de modificar el sistema operativo. Esto es posible gracias a Magisk.

## ¬øQu√© es Magisk?

Magisk es una herramienta de rooteo de c√≥digo abierto para Android, la cual sustituye a las antiguas soluciones de rooteo que funcionan modificando el sistema operativo. Como Magisk no modifica la partici√≥n del sistema sino que se instala como una capa adicional superpuesta al sistema operativo, es una t√©cnica conocida como _systemless root_.

¬øCu√°l es la ventaja de este m√©todo? Que al no haber modificado el sistema desde su ra√≠z, los fabricantes no son capaces de detectar que el tel√©fono ha sido modificado, por lo que el dispositivo puede serguir recibiendo actualizaciones y ejecutando aplicaciones sensibles mientras tienes acceso como superusuario. Adem√°s, permite pasar los test de seguridad e integridad m√°s exigentes, como SafetyNet.

A continuaci√≥n vamos a explicar c√≥mo convertirnos en superusuario de nuestro m√≥vil Android empleando esta herramienta y manteniendo la integridad del dispositivo.

## C√≥mo instalar Magisk en nuestro dispositivo Android

Para comenzar con el proceso, suelo recomendar (salvo honrosas excepciones) el reseteo del dispositivo a su estado de f√°brica. Me gusta hacerlo para garantizar que el m√≥vil en cuesti√≥n se encuentre en un estado por defecto para cerciorarme de que no habr√° configuraciones que puedan interferir en los procesos que se van a explicar a continuaci√≥n. En mi caso, voy a estar trabajando con un Motorola Moto G5 (lo s√©, es tela de viejo) con la versi√≥n de Android 8.1. Como informaci√≥n adicional, os contar√© que este dispositivo no iba a ser el elegido para la realizaci√≥n de este post, si no que iba a ser un Xiaomi Redmi 9 Pro. Sin embargo, los dispositivos Xiaomi son un poco pu√±eteros y os hablar√© de ello m√°s adelante en este post para que lo teng√°is en cuenta en futuras situaciones.

Bien, en primer lugar ten√©is que saber que al conectar un dispositivo f√≠sico con la configuraci√≥n por defecto al ordenador solo podr√©is realizar las opciones b√°sicas que este te ofrece, que suelen ser la carga de la bater√≠a o la transferencia de archivos. Si quisi√©ramos realizar operaciones por consola empleando las _platform-tools_ como por ejemplo _adb_ no podr√≠amos. Pod√©is realizar la prueba enchufando vuestro dispositivo al PC y ejecutando el comando _adb devices_. No os aparecer√° nada. Para poder trabajar desde consola con las herramientas pertinentes, tendremos que habilitar las opciones de desarrollador en nuestro dispositivo m√≥vil.

ATENCI√ìN: A partir de aqu√≠ vamos a necesitar utilizar las herramientas mencionadas en las _platform-tools_, en concreto _adb_ y _fastboot_. Si todav√≠a no las tienes las puedes encontrar en los siguientes enlaces:

- [Herramientas de la plataforma del SDK](https://developer.android.com/tools/releases/platform-tools?hl=es-419)
- [ADB Instructions](https://gist.github.com/ifiokjr/b70882d3f1182ed48ec7eefa5c93a740)
- [Descarga directa de las Platform-Tools para Windows](https://dl.google.com/android/repository/platform-tools-latest-windows.zip?hl=es-419)

## Habilitar las Opciones de Desarrollador en nuestro dispositivo

Las opciones de desarrollador son unas opciones avanzadas de configuraci√≥n del dispositivo m√≥vil que siempre se encuentran ocultas en una primera instancia para que la gente a nivel usuario no las tenga muy a mano, ya que algunas requieren de un conocimiento y un uso responsable para no causar alg√∫n estropicio en el tel√©fono. La visualizaci√≥n de estas opciones es pr√°cticamente igual en todos los m√≥viles de todas las marcas, por lo que ser√° sencillo habilitarlas. En mi caso concreto, los pasos son los siguientes:

- _Ajustes ‚Üí Sistema ‚Üí Acerca del tel√©fono ‚Üí N√∫mero de compilaci√≥n ‚Üí Pulsarlo 7 veces_

En otras marcas puede variar un poco, y en lugar de entrar a _Sistema_ quiz√° haya que entrar a _General_, en lugar de _Acerca del tel√©fono_ puede que sea _Informaci√≥n del dispositivo_, pero lo que es com√∫n en todos ser√° en encontrar el n√∫mero de compilaci√≥n y habr√° que pulsarlo 7 veces (por muy raro que suene). Os aparecer√°n mensajes estilo _Toca 3 veces m√°s para habilitar las opciones de desarrolador,_ y finalmente algo parecido a _Opciones de Desarrollador habilitadas_.

![Mensaje de habilitaci√≥n de opciones de desarrollador en Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-1.avif)

Una vez hecho esto, os habr√°n aparecido estas opciones normalmente en la pesta√±a de _General_ o de _Sistema_. Si no las encontr√°is, pod√©is utilizar el buscador del tel√©fono para encontrarlas:

![Men√∫ de opciones de desarrollador en Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-2.avif)

Dentro de las Opciones de Desarrollo nos aparecen much√≠simas pesta√±as y acciones avanzadas para habilitar o configurar. Sin embargo, a nosotros √∫nicamente nos va a interesar habilitar dos de ellas: **Depuraci√≥n por USB** y **Desbloqueo de OEM**.

## Depuraci√≥n por USB

La depuraci√≥n por USB es lo que va a habilitar la comunicaci√≥n por cable entre el dispositivo m√≥vil y el ordenador, permitiendo as√≠ interactuar con las aplicaciones y la memoria del dispositivo. Dicho de otro modo, cuando habilit√°is esta opci√≥n ya podr√©is visualizar el dispositivo con _adb_ y realizar acciones sobre √©l. Eso s√≠, os saldr√° un mensaje en la pantalla de vuestro Android donde tendr√©is que _confiar_ en la conexi√≥n establecida:

<div class="grid grid-cols-2 gap-4">
<div>

![Terminal mostrando dispositivo Android conectado con ADB](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-3.avif)

</div>
<div>

![Mensaje de confianza para depuraci√≥n USB en Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-4.avif)

</div>
</div>

En este punto, es un buen momento para realizar una comprobaci√≥n: vamos a instalar **Magisk** y veremos si la aplicaci√≥n nos otorga alg√∫n tipo de privilegio siguiendo un proceso habitual de instalaci√≥n de aplicaciones. Para ello, y **desde nuestro dispositivo m√≥vil**, vamos a ir al repositorio de GitHub de la aplicaci√≥n al apartado _Releases_ y vamos a descargar la apk que se encuentra alli en el siguiente enlace:

- [Magisk releases](https://github.com/topjohnwu/Magisk/releases/)

![P√°gina de releases de Magisk en GitHub](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-5.avif)

> Nota: en algunos dispositivos (Samsung Galaxy S9+ que sepamos) la versi√≥n v27.0 de Magisk puede dar un error "recv\_fd: msg\_flags = 0, msg\_controllen(0) !=24" al intentar usar permisos de root en aplicaciones. En este caso descargando la versi√≥n mas reciente a d√≠a de hoy (la v28.0) solventa el problema.

Una vez obtenida, accedemos a descargas y la instalamos. Nos pedir√° confiar en aplicaciones descargadas desde nuestro navegador, por lo que seguramente tendremos que acceder a los ajustes del navegador y seleccionar en la opci√≥n _Confiar en esta fuente_. Una vez hecho esto, abrimos Magisk. La aplicaci√≥n en s√≠, no tiene mucho. Lo que nos interesa ser√° ver que de las 4 pesta√±as que se ven en la parte inferior, habr√° 2 que no ser√° posible acceder, las cuales son _Superusuario_ y _M√≥dulos_. Adem√°s, nos indicar√° que _Zygisk_ (La ejecuci√≥n de Magisk en el proceso Zygote, el primer proceso del sistema operativo) no se encuentra instalado. Esto nos indica que no hemos obtenido privilegios de ning√∫n tipo por arte de magia:

![Aplicaci√≥n Magisk sin permisos root instalados](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-6.avif)

Para garantizar que no tenemos ning√∫n tipo de privilegio, podemos instalar cualquier aplicaci√≥n de las denominadas _Root Checker_ que nos indica cu√°ndo un dispositivo est√° rooteado y cu√°ndo no. La que yo suelo usar es la siguiente (os dejo enlace de _apkpure_ para descargar en el dispositivo m√≥vil porque no est√° en GitHub):

- [Root Checker](https://apkpure.com/es/root-checker/com.joeykrim.rootcheck)

![Root Checker mostrando que el dispositivo no tiene acceso root](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-7.avif)

Una vez hemos instalado la aplicaci√≥n y hemos comprobado que simplemente por instalarla no somos root, vamos a modificar la extensi√≥n de la descarga de Magisk de _apk_ a _zip_ (sin eliminar la aplicaci√≥n del dispositivo) y la almacenaremos en la carpeta de descargas. Esto lo necesitaremos m√°s adelante:

![Cambio de extensi√≥n del archivo Magisk de APK a ZIP](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-8.avif)

Tras haber finalizado con el procedimiento de Depuraci√≥n por USB volvemos a la otra opci√≥n de desarrollador que necesit√°bamos habilitar.

## Desbloqueo de OEM

El desbloqueo de OEM (_Original Equipment Manufacturer_) implica desbloquear la protecci√≥n del fabricante sobre el dispositivo m√≥vil. Esto abre un abanico de posibilidades, y una de las utilidades que nos interesa es que se ha desbloqueado el _bootloader_ del dispositivo. El _bootloader_ o gestor de arranque, es la primera herramienta que se ejecuta al iniciar un dispositivo y realiza varias comprobaciones antes de cargar el sistema operativo. Cuando esta opci√≥n est√° deshabilitada, solo es posible arrancar las particiones por defecto del fabricante, por lo que al habilitar este desbloqueo se abre la posibilidad de hacer modificaciones a nivel de software.

Adem√°s, con esta opci√≥n se ha habilitado la instalaci√≥n de una _Custom Recovery_ (Recuperaci√≥n personalizada). El modo _Recovery_ es b√°sicamente una partici√≥n de Android similar a la _BIOS_ de Windows, la cual es independiente por lo que tiene propiedades de arranque individual. Como de costumbre, este modo por defecto permite realizar recuperaciones del sistema o instalaciones oficiales. Sin embargo, al utilizar una _Custom Recovery_ las posibilidades se ampl√≠an, y una de ellas es la instalaci√≥n de aplicaciones con la extensi√≥n _zip_ que lo que har√° ser√° instalar la aplicaci√≥n directamente en el sistema ra√≠z. Por esta raz√≥n antes hemos guardado la aplicaci√≥n de Magisk en este formato.

![Opci√≥n de desbloqueo de OEM en las opciones de desarrollador](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-9.avif)

Que esta imagen no os sirva de gu√≠a, ya que la tom√© despu√©s de haber realizado acciones que vamos a explicar a continuaci√≥n, y por eso sale con ese tono gris. Esto lo menciono porque simplemente con habilitar este desbloqueo no se han activado las opciones que os acabo de detallar (al menos en la mayor√≠a de dispositivos).

Esta es la parte m√°s delicada de todo el proceso, ya que cada marca de m√≥viles funciona de una manera distinta y algunos desbloqueos del _bootloader_ pueden ser una aut√©ntica odisea. La parte buena es que se pueden encontrar detalles de cada marca en Internet para desbloquearlo, por lo que siguiendo los pasos que vamos a ver solo habr√≠a que adaptar el proceso a cada modelo.

## Desbloqueo de Bootloader e instalaci√≥n del Custom Recovery

Empezamos con la chicha. Voy a explicar todo el proceso a seguir de manera gen√©rica y habr√° partes en las que especifique lo que tuve que hacer yo personalmente para mi modelo de dispositivo, e intentar√© poner otros ejemplos que puedan ser √∫tiles.

Antes de comenzar con todo el proceso vamos a realizar la descarga de la imagen del software de _Custom Recovery_ que hemos mencionado anteriormente y que vamos a utilizar. Para ello existen varias webs en las que buscar y encontrar estas im√°genes para cada marca y modelo, ya que hay distinci√≥n tambi√©n entre dispositivos de la misma marca. El m√°s famoso es TWRP, aunque tambi√©n hay otras p√°ginas como Orangefox:

- [Devices - TWRP](https://twrp.me/Devices/)
- [OrangeFox Recovery](https://orangefox.download/es-ES)

Adem√°s, **√∫nicamente si tu dispositivo es un Samsung**, vais a necesitar descargar el software _Od√≠n_ para realizar el paso de cargar la imagen del _Custom Recovery_ en el dispositivo en lugar de hacerlo por consola:

- [Samsung Odin](https://odindownload.com/)

En mi caso, busco mi modelo de Motorola y encuentro la imagen que me corresponde:

![Listado de dispositivos Motorola en TWRP](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-10.avif)

![Descarga de la imagen TWRP para Motorola](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-11.avif)

Guardamos esta imagen en la carpeta de _platform-tools_. Hecho esto, el primer paso ser√° abrir una cmd con permisos de administrador (por si acaso) en nuestra m√°quina Windows desde la carpeta de las mencionadas anteriormente _platform-tools_. Nos tenemos que asegurar que dentro se encuentran tanto el ejecutable _adb.exe_ como el _fastboot.exe_. Con el dispositivo m√≥vil conectado al ordenador como hemos ido explicando a lo largo del post, comenzamos a ejecutar los siguientes comandos:

- adb devices ‚Üí Comprueba si nuestro dispositivo se encuentra disponible para la ejecuci√≥n de comandos y lo muestra
- adb reboot bootloader ‚Üí Iniciamos el modo _bootloader_ o _gestor de arranque_ de nuestro Android
- fastboot devices ‚Üí Comprueba si el dispositivo est√° conectado y reconoce el modo _bootloader_ mostr√°ndolo
- fastboot flash recovery \[imagen del Custom Recovery\] ‚Üí El comando flash se emplea para escribir datos sobre una partici√≥n, que en este caso es la partici√≥n _Recovery_ que mencionamos y explicamos unos p√°rrafos m√°s arriba. Por tanto, lo que estamos haciendo es sustituir el modo de recuperaci√≥n por defecto por uno personalizado.

Si todo a salido a la perfecci√≥n a la primera (cosa que me parecer√≠a pr√°cticamente un milagro) vuestra terminal tendr√≠a aproximadamente el siguiente aspecto:

![Terminal mostrando proceso exitoso de instalaci√≥n de TWRP](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-12.avif)

Antes de continuar con el proceso a partir de este punto, vamos a hablar sobre los problemas que casi con total seguridad vais a tener que solventar, porque como ya mencion√© anteriormente, esta es la parte m√°s engorrosa de todo el proceso:

- **PROBLEMA 1 :** El OEM no se ha desbloqueado correcta o completamente.
- **PROBLEMA 2** : El comando _fastboot devices_ no muestra vuestro dispositivo.
- **PROBLEMA 3 :** Est√°is intentando instalar una imagen que no es la que se corresponde con vuestro dispositivo. Por favor, aseguraos bien de que la seleccion√°is correctamente.

Si hab√©is tenido la suerte de hacerlo a la primera sin tener que resolver ning√∫n error, cu√©ntamelo en los comentarios y dime qu√© modelo de dispositivo Android hab√©is utilizado! üòÄ

#### Problema 1: El OEM no se ha desbloqueado correcta o completamente

Para reconocer este problema os encontrar√©is en la parte de la instalaci√≥n de la imagen. Tras encontrar el dispositivo con el comando _fastboot devices_ y ejecuteis el _fasboot flash recovery_ os aparecer√° un mensaje en el que se muestra el error '_not allowed in locked state_' como se puede ver a continuaci√≥n:

![Error de OEM bloqueado en fastboot](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-13.avif)

Para comprobar si realmente el OEM se ha desbloqueado, podemos ejecutar el siguiente comando en este mismo punto del proceso:

- fastboot flashing get\_unlock\_ability

El valor de este par√°metro debe de ser 1 en caso de que se encuentre desbloqueado correctamente. Si nos ha mostrado el error de la imagen anterior, el valor ser√° de 0:

![Comando fastboot mostrando capacidad de desbloqueo en 0](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-14.avif)

Existe un comando que en teor√≠a realiza el desbloqueo del OEM desde la consola, que es el siguiente:

- fastboot oem unlock

Quiz√° teng√°is suerte y os funcione, pero a mi me ha dado error en diferentes dispositivos:

![Error al ejecutar comando fastboot oem unlock](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-15.avif)

En este punto tendremos que realizar una peque√±a b√∫squeda sobre c√≥mo desbloquear el OEM seg√∫n nuestro fabricante. Os expongo mi caso con Motorola para que os sirva como referencia, ya que es muy similar en todos los dispositivos. Simplemente realic√© la b√∫squeda de ‚Äò_oem unlock motorola_‚Äô en Google y me acab√≥ llevando al siguiente enlace de su web oficial:

- [Web Oficial de Motorola](https://en-us.support.motorola.com/)

Me registr√© con mi correo (no lo hag√°is si no ten√©is un Motorola) y solicit√© el c√≥digo para desbloquearlo (el fabricante te da su consentimiento para llevar a cabo esta acci√≥n, por as√≠ decirlo). El correo me lleg√≥ de manera inmediata:

![Correo de Motorola con c√≥digo de desbloqueo de bootloader](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-16.avif)

Una vez hecho esto, segu√≠ los pasos que aparec√≠an en la URL mencionada anteriormente:

![Instrucciones de Motorola para desbloqueo de bootloader](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-17.avif)

Estos pasos os sonar√°n de haberlos visto m√°s arriba. El comando clave, que tambi√©n os sonar√°, es el siguiente:

- fasboot oem unlock <UNIQUE\_KEY>

Ejecutando ese comando con el c√≥digo recibido por correo se realizar√° el desbloqueo del OEM y ya podremos instalar la imagen. Problema solventado üòé

###### Bonus: Desbloquear el OEM en un dispositivo Xiaomi

Como contenido a√±adido, os voy a contar la experiencia que os coment√© al comenzar el post con el dispositivo Xiaomi (de hecho las capturas de errores de este apartado son con ese m√≥vil). Al acceder a las opciones de desarrollador de los dispositivos de esta marca, adem√°s de la opci√≥n de desbloqueo de OEM, existe otra denominada _Estado Mi Unlock_:

![Opciones de desarrollador en Xiaomi mostrando Estado Mi Unlock](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-18.avif)

Al acceder a este apartado, vemos un mensaje del dispositivo en el que te indican los permisos que se necesitan para poder desbloquear el OEM, que no son pocos precisamente:

![Permisos requeridos para desbloqueo en Xiaomi](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-19.avif)

Si pulsamos en _De acuerdo_ y decidimos regalarle nuestra alma a nuestros amigos asi√°ticos, aparecer√°n unos pasos a seguir para continuar con el proceso:

![Pasos para solicitar desbloqueo en Xiaomi](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-20.avif)

A modo resumen, necesitas tener una cuenta _Mi_ vinculada en el dispositivo y la tarjeta SIM con datos y conexi√≥n a Internet dentro del mismo. Al cumplir estos requisitos, tendr√°s que descargarte la aplicaci√≥n a tu ordenador desde el siguiente enlace:

- [Apply for permissions to unlock Mi devices](https://en.miui.com/unlock/download_en.html)

Una vez descargada y con el dispositivo conectado al PC, al acceder a la aplicaci√≥n deber√°s acceder a la misma cuenta _Mi_ empleada en el Xiaomi. Una vez dentro, se verificar√°n que se cumplen todas las condiciones mencionadas anteriormente, y la aplicaci√≥n te permitir√° solicitar el desbloqueo, el cual puede tardar hasta 70 horas. Tendr√°s que ser t√∫ el que vuelva a abrir la aplicaci√≥n y repetir este √∫ltimo proceso para, por fin, conseguir el desbloqueo del dispositivo. Tener en cuenta que al realizar esta acci√≥n, el dispositivo se resetea a los valores de f√°brica, por lo que perder√≠as todos los datos almacenados en el tel√©fono.

#### Problema 2: El comando _fastboot devices_ no muestra vuestro dispositivo

La localizaci√≥n de este problema es bastante simple: al encontrarnos en el modo _bootloader_ y ejecutar el comando _fastboot devices_ no se muestra ning√∫n dispositivo. Esto se debe a que es necesario instalar unos drivers de Google para poder realizar algunas acciones de las herramientas _adb_ y _fastboot_. En primer lugar, descargaremos estos drivers que se encuentran en el siguiente portal de Android:

- [Get the Google USB Driver](https://developer.android.com/studio/run/win-usb)

Tambi√©n pod√©is descargarlo de manera directa a trav√©s del siguiente enlace:

- [dl.google.com](https://dl.google.com/android/repository/usb_driver_r13-windows.zip)

Una vez descargados, vamos a descomprimir la carpeta y copiarla a la carpeta de nuestras _platform tools_. Bien, con nuestro dispositivo conectado por USB a nuestro ordenador en el modo _bootloader_ vamos a hacer lo siguiente:

- _Ctrl + X (o click derecho en el icono de Windows) ‚Üí Administrador de dispositivos ‚Üí Otros dispositivos_

Nos tendr√° que aparecer un dispositivo Android conectado con una se√±al amarilla con una exclamaci√≥n:

![Administrador de dispositivos mostrando dispositivo Android sin drivers](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-21.avif)

Haremos click derecho en el dispositivo _Android_ y seleccionaremos la opci√≥n _Actualizar controladores_. A continuaci√≥n, los pasos a seguir son los siguientes:

1\. Examinar en mi PC en busca de controladores

![Opci√≥n examinar en PC para buscar controladores](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-22.avif)

2\. Elegir una lista de controladores disponibles en el equipo

![Elegir lista de controladores disponibles](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-23.avif)

3\. Mostrar todos los dispositivos ‚Üí Siguiente

![Mostrar todos los dispositivos en Windows](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-24.avif)

4\. Usar disco

![Opci√≥n usar disco para instalaci√≥n de drivers](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-25.avif)

5\. Buscar ‚Üí Seleccionamos el archivo _android\_winsub.inf_ de la carpeta de drivers

![Selecci√≥n del archivo INF de drivers de Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-26.avif)

6\. Siguiente

![Confirmaci√≥n de instalaci√≥n de drivers de Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-27.avif)

7\. Cerrar

![Instalaci√≥n exitosa de drivers de Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-28.avif)

Como podeis observar, se han instalado los drivers para las interfaces de _adb_ y _bootloader_. Una vez finalizado el proceso, el icono (y quiz√° el dispositivo) habr√°n desaparecido y en su lugar aparecer√° _Android ADB Interface_ en la parte superior del panel de controladores. Ahora s√≠, pod√©is volver a vuestra consola y volver a ejecutar el comando _fastboot devices_, y os aparecer√° vuestro dispositivo.

## Uso del Custom Recovery e instalaci√≥n de Magisk en el sistema ra√≠z

Bien, si has tenido que resolver alguno (o ambos) de los problemas anteriormente detallados, enhorabuena, lo peor ya ha pasado. Lo que queda es un mero tr√°mite para finalizar con el proceso. Volvemos a este punto:

![Terminal con comandos fastboot exitosos](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-29.avif)

En este punto nos toca arrancar el dispositivo en modo _recovery_ como explicamos m√°s arriba. Tenemos varias opciones:

- Si estamos en modo _bootloader_ utilizaremos el comando: _fastboot reboot recovery._
- Si el dispositivo se ha reiniciado y estamos conectados al ordenador: adb reboot recovery.
- Si tenemos el dispositivo apagado, lo encenderemos apretando los botones de desbloqueo y volumen arriba (esta combinaci√≥n puede cambiar seg√∫n la marca).

Una vez hecho esto, se abrir√° el men√∫ de TWRP. Seleccionaremos la opci√≥n de Instalar como se muestra a continuaci√≥n:

![Men√∫ principal de TWRP Recovery](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-30.avif)

Lo siguiente que haremos ser√° navegar entre las carpetas hasta encontrar el archivo zip de Magisk, localizado en /sdcard/Download:

![Navegaci√≥n en TWRP hacia archivo ZIP de Magisk](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-31.avif)

Una vez seleccionado, nos aparecer√° el √∫ltimo paso de la instalaci√≥n en el que tendremos que deslizar para confirmar el proceso:

![Confirmaci√≥n de instalaci√≥n de Magisk en TWRP](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-32.avif)

Tras un breve periodo de instalaci√≥n, reiniciaremos nuestro Android para comprobar que todo ha funcionado correctamente. Al ejecutar la aplicaci√≥n Magisk, esta nos pedir√° su reinstalaci√≥n debido a los nuevos permisos obtenidos sobre el sistema. Una vez hecho esto, abriremos la aplicaci√≥n y observaremos que, a diferencia de como ocurr√≠a con el estado de la aplicaci√≥n al comienzo de este post, todas las opciones se encuentran desbloqueadas:

![Magisk instalado con acceso root completo](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-33.avif)

En esta ocasi√≥n, la aplicaci√≥n _Root Checker_ si nos va a detectar que tenemos privilegios sobre el sistema:

![Root Checker confirmando acceso root en el dispositivo](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-34.avif)

Finalmente tenemos privilegios de administrador sobre nuestro dispositivo, lo que nos permitir√° trabajar con √©l en entornos de pentesting para la realizaci√≥n de pruebas.

A simple vista puede parecer un procedimiento largo y tedioso, pero teniendo controlado lo que hay que hacer en cada parte del proceso, se hace m√°s r√°pido de lo que os imagin√°is. Probarlo y contarme qu√© tal os ha ido üòâ

## Bonus: Instalaci√≥n del certificado de Burp Suite a trav√©s de Magisk

Os voy a regalar el proceso para instalar el certificado de Burp Suite a trav√©s de Magisk ya que es extremadamente sencillo. En primer lugar tendremos que configurar el proxy en nuestro dispositivo m√≥vil de la misma manera que lo hicimos en un dispositivo virtual en el post sobre _[tunelizar e interceptar el tr√°fico en Android](https://blog.deephacking.tech/es/posts/como-tunelizar-e-interceptar-trafico-android/)_. Seleccionaremos la IP de nuestra red wifi para establecerla tanto en Burp Suite como en el Android (ambas capturas proceden de dicho art√≠culo):

![Configuraci√≥n de proxy en Burp Suite](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-35.avif)

![Configuraci√≥n de proxy en Android](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-36.avif)

Una vez hecho esto instalamos el certificado como se hac√≠a en la √©poca de los dinosaurios, desde el navegador del dispositivo accediendo a la URL http://burpsuite:

![P√°gina de descarga del certificado de Burp Suite](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-37.avif)

Como ya explicamos en el post que he mencionado hace dos p√°rrafos, de esta manera el certificado se instala en las _Credenciales de confianza_ del usuario, no del sistema. Nos da igual:

![Certificado de Burp Suite en credenciales de usuario](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-38.avif)

Si record√°is la aplicaci√≥n de Magisk, existe un apartado que se llama M√≥dulos. Actualmente se encuentra vac√≠o, pero vamos a instalar nuestro primer m√≥dulo para que nuestro certificado nos permita interceptar el tr√°fico http. Para ello, accederemos al siguiente repositorio de GitHub:

- **[System Burp Certificate](https://github.com/belane/burpcert-magisk-module)**

En √©l nos detalla que lo que hace este m√≥dulo es mover los certificados instalados por el usuario a las _Credenciales de confianza_ del sistema. Para ello, en la pesta√±a de releases nos descargaremos el archivo zip _burpcert-magisk-module_:

- [burpcert-magisk-module-v0.9.zip](https://github.com/belane/burpcert-magisk-module/releases/download/v0.9/burpcert-magisk-module-v0.9.zip)

Una vez hemos descargado el archivo, accederemos a la aplicaci√≥n _Magisk ‚Üí M√≥dulos_ y seleccionaremos la opci√≥n _Instalar desde almacenamiento_:

![Opci√≥n para instalar m√≥dulos desde almacenamiento en Magisk](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-39.avif)

Seleccionaremos el archivo mencionado previamente:

![Selecci√≥n del m√≥dulo burpcert en Magisk](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-40.avif)

Una vez hecho esto, se realiza la instalaci√≥n de este m√≥dulo y su habilitaci√≥n:

![Instalaci√≥n exitosa del m√≥dulo burpcert en Magisk](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-41.avif)

En este punto, volvemos a acceder a las _Credenciales de confianza_ del dispositivo, donde el certificado de Burp Suite ha sido movido a la pesta√±a de sistema:

![Certificado de Burp Suite movido a credenciales del sistema](https://cdn.deephacking.tech/i/posts/configuracion-dispositivo-fisico-android/configuracion-dispositivo-fisico-android-42.avif)

Tras esta comprobaci√≥n, ya podemos interceptar el tr√°fico http para realizar nuestras pruebas de pentesting en dispositivos Android.

## Conclusi√≥n

Aunque pueda parecer un proceso tedioso en algunas de sus partes, os garantizo que el empleo de un dispositivo f√≠sico para realizar pruebas de seguridad es mucho m√°s c√≥modo que el empleo de dispositivos virtuales, evitando malgastar mucho almacenamiento en el disco duro de vuestro ordenador. Os aseguro que la configuraci√≥n es muy r√°pida y merecer√° la pena. Contarme qu√© tal os ha ido y si est√°is contentos con vuestra nueva herramienta de trabajo :)

Un abrazo!

## Referencias

- [Magisk Module](https://www.magiskmodule.com/)
- [Repositorio de Magisk](https://github.com/topjohnwu/Magisk)
- [Qu√© es el Bootloader en Android, qu√© hace, y para qu√© sirve desbloquearlo - Xataka](https://www.xataka.com/basics/que-bootloader-android-que-hace-sirve-desbloquearlo)
- [Root en Android: qu√© es, para qu√© sirve y cu√°les son sus inconvenientes](https://www.xataka.com/basics/root-android-que-sirve-cuales-sus-inconvenientes)
